{% if section.settings.demo_content and section.blocks.size > 0 %}
  <section class="collection-page">
    <div class="collection-page__inner">
      <div class="collection-page__content">
        <header class="collection-page__header">
          <h1 class="collection-page__title">{{ section.settings.demo_heading | default: collection.title }}</h1>
          {% if section.settings.demo_count != blank %}
            <p class="collection-page__count">{{ section.settings.demo_count }}</p>
          {% endif %}
        </header>

        <div class="collection-page__grid collection-page__grid--demo">
          {% for block in section.blocks %}
            <article class="collection-demo-card" style="background: linear-gradient(135deg, {{ block.settings.gradient_start }} 0%, {{ block.settings.gradient_end }} 100%);" {{ block.shopify_attributes }}>
              <div class="collection-demo-card__meta">
                {% if block.settings.eyebrow != blank %}
                  <p class="collection-demo-card__eyebrow">{{ block.settings.eyebrow }}</p>
                {% endif %}
                {% if block.settings.title != blank %}
                  <h3 class="collection-demo-card__title">{{ block.settings.title }}</h3>
                {% endif %}
                {% if block.settings.link_label != blank %}
                  {% render 'arrow-link',
                    text: block.settings.link_label,
                    url: block.settings.link | default: '#',
                    class: 'collection-demo-card__link',
                    icon_size: '14'
                  %}
                {% endif %}
              </div>
            </article>
          {% endfor %}
        </div>
      </div>
    </div>
  </section>
{% else %}
  {% paginate collection.products by section.settings.products_per_page %}
    <section class="collection-page">
      <div class="collection-page__inner">
        {% if section.settings.show_sidebar %}
          <aside class="collection-page__sidebar">
            {% if section.settings.sidebar_title != blank %}
              <p class="collection-page__menu-title">{{ section.settings.sidebar_title }}</p>
            {% endif %}

            {% if section.settings.sidebar_menu != blank and linklists[section.settings.sidebar_menu] %}
              <ul class="collection-page__menu" aria-label="{{ section.settings.sidebar_title | default: 'Collections' }}">
                {% for link in linklists[section.settings.sidebar_menu].links %}
                  <li><a href="{{ link.url }}" {% if link.active %}class="is-active"{% endif %}>{{ link.title }}</a></li>
                {% endfor %}
              </ul>
            {% endif %}

            {% if section.settings.sidebar_links != blank %}
              <ul class="collection-page__menu" aria-label="{{ 'general.navigation' | t }}">
                {% assign quick_links = section.settings.sidebar_links | split: '\n' %}
                {% for item in quick_links %}
                  {% assign parts = item | strip | split: '|' %}
                  {% if parts[0] != blank %}
                    <li><a href="{{ parts[1] | default: '#' }}">{{ parts[0] }}</a></li>
                  {% endif %}
                {% endfor %}
              </ul>
            {% endif %}
          </aside>
        {% endif %}

        <div class="collection-page__content">
          <header class="collection-page__header">
            <div class="collection-page__header-row">
              <h1 class="collection-page__title">
                {{ collection.title }}
                <span class="collection-page__title-count">{{ collection.products_count }}</span>
              </h1>
              
              <div class="collection-page__controls">
                {% if collection.filters.size > 0 %}
                  <button class="collection-page__filter-toggle" 
                          id="collectionFilterToggle" 
                          aria-expanded="false" 
                          aria-controls="collectionFilters">
                    <span class="collection-page__filter-icon">+</span>
                    <span class="collection-page__filter-text">Filter</span>
                  </button>
                {% endif %}
                
                <div class="collection-page__view-toggle">
                  <span class="collection-page__view-label">View:</span>
                  <div class="collection-page__view-buttons">
                    <button class="collection-page__view-btn" data-view="small">S</button>
                    <button class="collection-page__view-btn is-active" data-view="medium">M</button>
                    <button class="collection-page__view-btn" data-view="large">L</button>
                  </div>
                </div>
              </div>
            </div>

            {% if collection.filters.size > 0 %}
              <div class="collection-page__filters" id="collectionFilters" aria-hidden="true">
                {% for filter in collection.filters %}
                  <div class="collection-page__filter-group">
                    <p class="collection-page__filter-label">{{ filter.label }}</p>
                    
                    {% case filter.type %}
                      {% when 'list' %}
                        <ul class="collection-page__filter-list">
                          {% for value in filter.values %}
                            <li class="collection-page__filter-item">
                              <a href="{{ value.url_to_add }}" 
                                 class="collection-page__filter-link{% if value.active %} is-active{% endif %}">
                                {{ value.label }}
                                {% if value.active %}
                                  <span class="collection-page__filter-remove" aria-label="Remove filter">Ã—</span>
                                {% endif %}
                              </a>
                            </li>
                          {% endfor %}
                        </ul>
                      
                      {% when 'price_range' %}
                        <div class="collection-page__filter-price">
                          <form action="{{ collection.url }}" method="get">
                            <input type="number" 
                                   name="filter.v.price.gte" 
                                   placeholder="Min" 
                                   value="{{ filter.min_value.value }}" 
                                   min="0">
                            <span>to</span>
                            <input type="number" 
                                   name="filter.v.price.lte" 
                                   placeholder="Max" 
                                   value="{{ filter.max_value.value }}" 
                                   min="0">
                            <button type="submit">Apply</button>
                          </form>
                        </div>
                    {% endcase %}
                  </div>
                {% endfor %}
                
                {% if collection.filters.size > 0 %}
                  <div class="collection-page__filter-actions">
                    <a href="{{ collection.url }}" class="collection-page__filter-clear">Clear all filters</a>
                  </div>
                {% endif %}
              </div>
            {% endif %}
          </header>

          <div class="collection-page__grid" data-view="medium">
            {% for product in collection.products %}
              {% render 'product-card', product: product %}
            {% endfor %}
          </div>

          {% render 'pagination', paginate: paginate %}
        </div>
      </div>
    </section>
  {% endpaginate %}
{% endif %}

{% schema %}
{
  "name": "Collection grid",
  "settings": [
    {
      "type": "checkbox",
      "id": "demo_content",
      "label": "Use demo content",
      "default": false
    },
    {
      "type": "text",
      "id": "demo_heading",
      "label": "Demo heading",
      "default": "Products"
    },
    {
      "type": "text",
      "id": "demo_count",
      "label": "Demo count",
      "default": "13 items"
    },
    {
      "type": "range",
      "id": "products_per_page",
      "label": "Products per page",
      "min": 6,
      "max": 48,
      "step": 6,
      "default": 12
    },
    {
      "type": "checkbox",
      "id": "enable_sorting",
      "label": "Enable sorting",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_sidebar",
      "label": "Show sidebar",
      "default": true
    },
    {
      "type": "text",
      "id": "sidebar_title",
      "label": "Sidebar heading",
      "default": "Collections"
    },
    {
      "type": "link_list",
      "id": "sidebar_menu",
      "label": "Sidebar menu"
    },
    {
      "type": "textarea",
      "id": "sidebar_links",
      "label": "Sidebar quick links",
      "info": "One per line in the format Label|URL"
    }
  ],
  "blocks": [
    {
      "type": "demo_card",
      "name": "Demo card",
      "settings": [
        {
          "type": "text",
          "id": "eyebrow",
          "label": "Eyebrow",
          "default": "Collection"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Lighting"
        },
        {
          "type": "text",
          "id": "link_label",
          "label": "Link label",
          "default": "Explore"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link"
        },
        {
          "type": "color",
          "id": "gradient_start",
          "label": "Gradient start",
          "default": "#8B6B47"
        },
        {
          "type": "color",
          "id": "gradient_end",
          "label": "Gradient end",
          "default": "#4A3426"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Collection grid",
      "blocks": [
        {
          "type": "demo_card",
          "settings": {
            "eyebrow": "Lighting",
            "title": "Pendants",
            "link_label": "Shop pendants",
            "gradient_start": "#8B6B47",
            "gradient_end": "#4A3426"
          }
        },
        {
          "type": "demo_card",
          "settings": {
            "eyebrow": "Seating",
            "title": "Chairs",
            "link_label": "Explore seating",
            "gradient_start": "#A0584F",
            "gradient_end": "#8B3A2F"
          }
        },
        {
          "type": "demo_card",
          "settings": {
            "eyebrow": "Tables",
            "title": "Dining",
            "link_label": "View tables",
            "gradient_start": "#B89968",
            "gradient_end": "#8B7E6A"
          }
        }
      ]
    }
  ]
}
{% endschema %}
