{% comment %}
  Studio Carousel Section
  Save this as: sections/studio-carousel.liquid
{% endcomment %}

<style>
  .studio-carousel-{{ section.id }} * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  .studio-carousel-{{ section.id }} {
    font-family: 'Georgia', serif;
    background-color: {{ section.settings.bg_color }};
    padding: 60px 20px;
  }

  .studio-carousel-{{ section.id }} .container {
    max-width: 1400px;
    margin: 0 auto;
  }

  .studio-carousel-{{ section.id }} .featured-label {
    color: {{ section.settings.label_color }};
    font-size: 11px;
    letter-spacing: 2px;
    font-weight: 600;
    margin-bottom: 20px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    text-transform: uppercase;
  }

  .studio-carousel-{{ section.id }} .featured-label::before {
    content: '■';
    margin-right: 10px;
  }

  .studio-carousel-{{ section.id }} h2 {
    font-size: 42px;
    font-weight: normal;
    color: {{ section.settings.heading_color }};
    margin-bottom: 60px;
  }

  .studio-carousel-{{ section.id }} .carousel-wrapper {
    position: relative;
    overflow: hidden;
  }

  .studio-carousel-{{ section.id }} .carousel {
    display: flex;
    transition: transform 0.6s ease;
  }

  .studio-carousel-{{ section.id }} .carousel-item {
    min-width: 100%;
    display: flex;
    gap: 0;
  }

  .studio-carousel-{{ section.id }} .image-container {
    flex: 1;
    background-color: {{ section.settings.image_bg_color }};
    min-height: 450px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    border: 1px solid {{ section.settings.border_color }};
  }

  .studio-carousel-{{ section.id }} .image-container img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .studio-carousel-{{ section.id }} .content {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: 60px 80px;
    background-color: {{ section.settings.bg_color }};
  }

  .studio-carousel-{{ section.id }} .figure-label {
    font-size: 15px;
    color: {{ section.settings.text_color }};
    margin-bottom: 30px;
    font-weight: normal;
    padding-bottom: 30px;
    border-bottom: 1px solid {{ section.settings.divider_color }};
  }

  .studio-carousel-{{ section.id }} .description {
    font-size: 19px;
    line-height: 1.7;
    color: {{ section.settings.text_color }};
    margin-bottom: 25px;
  }

  .studio-carousel-{{ section.id }} .read-more {
    display: inline-flex;
    align-items: center;
    color: {{ section.settings.text_color }};
    text-decoration: none;
    font-size: 15px;
    transition: transform 0.2s;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    padding-top: 20px;
    border-top: 1px solid {{ section.settings.divider_color }};
    align-self: flex-start;
  }

  .studio-carousel-{{ section.id }} .read-more:hover {
    transform: translateX(5px);
  }

  .studio-carousel-{{ section.id }} .read-more::after {
    content: '→';
    margin-left: 10px;
  }

  @media (max-width: 968px) {
    .studio-carousel-{{ section.id }} .carousel-item {
      flex-direction: column;
    }

    .studio-carousel-{{ section.id }} h2 {
      font-size: 32px;
    }

    .studio-carousel-{{ section.id }} .content {
      padding: 40px;
      border-left: 1px solid {{ section.settings.border_color }};
    }

    .studio-carousel-{{ section.id }} .image-container {
      border-bottom: none;
    }
  }
</style>

<div class="studio-carousel-{{ section.id }}">
  <div class="container">
    {% if section.settings.show_label %}
      <div class="featured-label">{{ section.settings.label_text }}</div>
    {% endif %}
    
    {% if section.settings.heading != blank %}
      <h2>{{ section.settings.heading }}</h2>
    {% endif %}

    <div class="carousel-wrapper" id="carouselWrapper-{{ section.id }}">
      <div class="carousel" id="carousel-{{ section.id }}">
        {% for block in section.blocks %}
          <div class="carousel-item" {{ block.shopify_attributes }}>
            <div class="image-container">
              {% if block.settings.image != blank %}
                {{ block.settings.image | image_url: width: 800 | image_tag: loading: 'lazy', alt: block.settings.image.alt }}
              {% else %}
                <div style="width: 100%; height: 100%; background-color: {{ section.settings.image_bg_color }};"></div>
              {% endif %}
            </div>
            <div class="content">
              {% if block.settings.label != blank %}
                <div class="figure-label">{{ block.settings.label }}</div>
              {% endif %}
              
              {% if block.settings.description != blank %}
                <p class="description">{{ block.settings.description }}</p>
              {% endif %}
              
              {% if block.settings.link_text != blank and block.settings.link_url != blank %}
                <a href="{{ block.settings.link_url }}" class="read-more">{{ block.settings.link_text }}</a>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>

<script>
  (function() {
    const sectionId = '{{ section.id }}';
    let currentSlide = 0;
    const carousel = document.getElementById('carousel-' + sectionId);
    const carouselWrapper = document.getElementById('carouselWrapper-' + sectionId);
    const totalSlides = {{ section.blocks.size }};
    let autoSlideInterval;
    let isPaused = false;
    const autoSlideSpeed = {{ section.settings.autoplay_speed | times: 1000 }};

    function updateCarousel() {
      carousel.style.transform = `translateX(-${currentSlide * 100}%)`;
    }

    function changeSlide(direction) {
      currentSlide += direction;
      if (currentSlide < 0) currentSlide = totalSlides - 1;
      if (currentSlide >= totalSlides) currentSlide = 0;
      updateCarousel();
    }

    function startAutoSlide() {
      {% if section.settings.enable_autoplay %}
        autoSlideInterval = setInterval(() => {
          if (!isPaused) {
            changeSlide(1);
          }
        }, autoSlideSpeed);
      {% endif %}
    }

    function stopAutoSlide() {
      clearInterval(autoSlideInterval);
    }

    // Pause on hover
    carouselWrapper.addEventListener('mouseenter', () => {
      isPaused = true;
    });

    carouselWrapper.addEventListener('mouseleave', () => {
      isPaused = false;
    });

    // Start the carousel
    startAutoSlide();
  })();
</script>

{% schema %}
{
  "name": "Studio Carousel",
  "tag": "section",
  "class": "studio-carousel-section",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_label",
      "label": "Show featured label",
      "default": true
    },
    {
      "type": "text",
      "id": "label_text",
      "label": "Label text",
      "default": "FEATURED"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "This Week in the Studio"
    },
    {
      "type": "header",
      "content": "Carousel Settings"
    },
    {
      "type": "checkbox",
      "id": "enable_autoplay",
      "label": "Enable autoplay",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "label": "Autoplay speed (seconds)",
      "min": 3,
      "max": 15,
      "step": 1,
      "default": 8
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background color",
      "default": "#e8e4dc"
    },
    {
      "type": "color",
      "id": "label_color",
      "label": "Label color",
      "default": "#6b5d4f"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading color",
      "default": "#1a1a1a"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#1a1a1a"
    },
    {
      "type": "color",
      "id": "image_bg_color",
      "label": "Image placeholder color",
      "default": "#d0cbc1"
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Border color",
      "default": "#b8b0a0"
    },
    {
      "type": "color",
      "id": "divider_color",
      "label": "Divider color",
      "default": "#c4bfb5"
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Carousel Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "label",
          "label": "Figure label",
          "default": "Fig. 1 — Walnut / Cream",
          "info": "e.g., Fig. 1 — Walnut / Cream"
        },
        {
          "type": "textarea",
          "id": "description",
          "label": "Description",
          "default": "A study in thickness, grain, and warm illumination."
        },
        {
          "type": "text",
          "id": "link_text",
          "label": "Link text",
          "default": "Read More"
        },
        {
          "type": "url",
          "id": "link_url",
          "label": "Link URL"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Studio Carousel",
      "blocks": [
        {
          "type": "slide",
          "settings": {
            "label": "Fig. 1 — Walnut / Cream",
            "description": "A study in thickness, grain, and warm illumination. Shape as invitation.",
            "link_text": "Read More"
          }
        },
        {
          "type": "slide",
          "settings": {
            "label": "Fig. 2 — Moss / Brass",
            "description": "Natural finish combinations with controlled reflectivity.",
            "link_text": "Journal Notes"
          }
        },
        {
          "type": "slide",
          "settings": {
            "label": "Fig. 3 — Oak / Stone",
            "description": "Exploring the intersection of organic materials and geometric form in contemporary design.",
            "link_text": "View Collection"
          }
        }
      ]
    }
  ]
}
{% endschema %}