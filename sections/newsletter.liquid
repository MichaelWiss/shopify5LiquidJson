{% assign is_simple = section.settings.layout_style == 'simple' %}
<section class="{% if is_simple %}newsletter{% else %}newsletter-section{% endif %}">
  <div class="newsletter-container">
    {% if section.settings.heading != blank %}
      {% if is_simple %}
        <h2>{{ section.settings.heading }}</h2>
      {% else %}
        <h2 class="newsletter-heading">{{ section.settings.heading }}</h2>
      {% endif %}
    {% endif %}

    {% if section.settings.text != blank and is_simple == false %}
      <p class="newsletter-text">{{ section.settings.text }}</p>
    {% endif %}

    {% assign newsletter_form_id = 'NewsletterForm-' | append: section.id %}
    {% form 'customer', id: newsletter_form_id, class: 'newsletter-form' %}
      {% if form.posted_successfully? %}
        {% if is_simple %}
          <p class="newsletter-success">{{ section.settings.success_message }}</p>
        {% else %}
          <p class="newsletter-feedback newsletter-feedback--success">{{ section.settings.success_message }}</p>
        {% endif %}
      {% else %}
        <input type="hidden" name="contact[tags]" value="newsletter">
        <input
          id="newsletter-email-{{ section.id }}"
          class="newsletter-input"
          type="email"
          name="contact[email]"
          value="{{ form.email | escape }}"
          placeholder="{{ section.settings.placeholder }}"
          required
        >
        <button class="newsletter-submit" type="submit">
          {{ section.settings.button_label }}
        </button>
        {% if form.errors %}
          {% if is_simple %}
            <p class="newsletter-error">{{ form.errors.translated_fields['email'] | default: form.errors.messages['email'] }}</p>
          {% else %}
            <p class="newsletter-feedback newsletter-feedback--error">{{ form.errors | default_errors }}</p>
          {% endif %}
        {% endif %}
      {% endif %}
    {% endform %}
  </div>
</section>

{% schema %}
{
  "name": "Newsletter",
  "settings": [
    {
      "type": "select",
      "id": "layout_style",
      "label": "Layout style",
      "options": [
        {
          "value": "detailed",
          "label": "Detailed (heading + supporting text)"
        },
        {
          "value": "simple",
          "label": "Simple (heading only)"
        }
      ],
      "default": "detailed"
    },
    {
      "type": "textarea",
      "id": "heading",
      "label": "Heading",
      "default": "Stay in the loop"
    },
    {
      "type": "textarea",
      "id": "text",
      "label": "Supporting text",
      "default": "Notes from the studio, launch announcements, and materials research. No noise.",
      "info": "Only shown in 'detailed' layout style"
    },
    {
      "type": "text",
      "id": "placeholder",
      "label": "Email placeholder",
      "default": "Email address"
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Button label",
      "default": "Subscribe"
    },
    {
      "type": "text",
      "id": "success_message",
      "label": "Success message",
      "default": "Thanks for subscribing."
    }
  ],
  "presets": [
    {
      "name": "Newsletter"
    }
  ]
}
{% endschema %}
